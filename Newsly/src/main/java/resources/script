-- Drop tables if they exist
DROP TABLE USUARIOS_NL;
DROP TABLE CATEGORIA_NL;
DROP TABLE NOTICIA_NL CASCADE CONSTRAINTS;
DROP TABLE COMENTARIO_NL CASCADE CONSTRAINTS;

-- Drop triggers
DROP TRIGGER TRG_USUARIOS_NL_BI;
DROP TRIGGER TRG_CATEGORIA_NL_BI;
DROP TRIGGER TRG_NOTICIA_NL_BI;
DROP TRIGGER TRG_COMENTARIO_NL_BI;

-- Drop sequences
DROP SEQUENCE SEQ_USUARIOS_NL;
DROP SEQUENCE SEQ_CATEGORIA_NL;
DROP SEQUENCE SEQ_NOTICIA_NL;
DROP SEQUENCE SEQ_COMENTARIO_NL;

-- Create tables
CREATE TABLE USUARIOS_NL(
    ID_USUARIO NUMBER(3) PRIMARY KEY NOT NULL,
    NOME VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(50) NOT NULL,
    SENHA VARCHAR(30) NOT NULL
);

CREATE TABLE CATEGORIA_NL(
    ID_CATEGORIA NUMBER(3) PRIMARY KEY NOT NULL,
    CATEGORIA VARCHAR2(30) NOT NULL
);

CREATE TABLE NOTICIA_NL(
    ID_NOTICIA NUMBER(3) PRIMARY KEY NOT NULL,
    ID_USUARIO NUMBER(3) NOT NULL,
    ID_CATEGORIA NUMBER(3) NOT NULL,
    TITULO VARCHAR2(50) NOT NULL,
    DESCRICAO VARCHAR2(100)
);

CREATE TABLE COMENTARIO_NL(
    ID_COMENTARIO NUMBER(3) PRIMARY KEY NOT NULL,
    ID_USUARIO NUMBER(3) NOT NULL,
    ID_NOTICIA  NUMBER(3) NOT NULL,
    COMENTARIO VARCHAR2(50) NOT NULL
);

-- Create sequences
CREATE SEQUENCE SEQ_USUARIOS_NL START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_CATEGORIA_NL START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_NOTICIA_NL START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SEQ_COMENTARIO_NL START WITH 1 INCREMENT BY 1;

-- Create triggers
CREATE OR REPLACE TRIGGER TRG_USUARIOS_NL_BI
BEFORE INSERT ON USUARIOS_NL
FOR EACH ROW
BEGIN
    :NEW.ID_USUARIO := SEQ_USUARIOS_NL.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER TRG_CATEGORIA_NL_BI
BEFORE INSERT ON CATEGORIA_NL
FOR EACH ROW
BEGIN
    :NEW.ID_CATEGORIA := SEQ_CATEGORIA_NL.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER TRG_NOTICIA_NL_BI
BEFORE INSERT ON NOTICIA_NL
FOR EACH ROW
BEGIN
    :NEW.ID_NOTICIA := SEQ_NOTICIA_NL.NEXTVAL;
END;
/

CREATE OR REPLACE TRIGGER TRG_COMENTARIO_NL_BI
BEFORE INSERT ON COMENTARIO_NL
FOR EACH ROW
BEGIN
    :NEW.ID_COMENTARIO := SEQ_COMENTARIO_NL.NEXTVAL;
END;
/

-- Add foreign keys
ALTER TABLE NOTICIA_NL ADD FOREIGN KEY (ID_USUARIO) REFERENCES USUARIOS_NL(ID_USUARIO);
ALTER TABLE NOTICIA_NL ADD FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA_NL(ID_CATEGORIA);
ALTER TABLE COMENTARIO_NL ADD FOREIGN KEY (ID_USUARIO) REFERENCES USUARIOS_NL(ID_USUARIO);
ALTER TABLE COMENTARIO_NL ADD FOREIGN KEY (ID_NOTICIA) REFERENCES NOTICIA_NL(ID_NOTICIA);

insert into CATEGORIA_NL (categoria) values ('Entretenimento');
insert into CATEGORIA_NL (categoria) values ('Saúde');
insert into CATEGORIA_NL (categoria) values ('Esporte');
insert into CATEGORIA_NL (categoria) values ('Negócios');
insert into CATEGORIA_NL (categoria) values ('Notícias Locais');


select * from categoria_nl;

COMMIT;